import{r as y,m as h,k as v,o as _,v as g,n as S,w as k,i as C,e as z,p as i,N,q as f,s as T}from"./index-5e2885e4.js";import{d as I,b as w}from"./index-302b296b.js";import{u as j}from"./use-table-operation-946f3f7c.js";import"./index.module-a00bcd5b.js";import{E as q}from"./EditOutlined-0243f050.js";import{u as x}from"./use-source-b1a7c19f.js";import{s as P}from"./index.module-fde20b4e.js";import{N as c}from"./Space-d49acb7b.js";import{N as U}from"./Select-94feec49.js";import{N as D}from"./Input-1bbd5e95.js";import{N as V,a as L}from"./DataTable-bb49b036.js";import"./service-d19f0ccd.js";import"./column-width-config-b963bc25.js";import"./lodash-11edae60.js";import"./DeleteOutlined-099c0ef1.js";import"./Popover-907f9950.js";import"./_baseMap-d2a29d52.js";import"./get-53588a31.js";import"./cssr-7767064c.js";import"./format-length-c9d165c6.js";import"./use-merged-state-d459d80e.js";import"./use-compitable-248ca92d.js";import"./next-frame-once-7035a838.js";import"./use-locale-ba0171d5.js";import"./Icon-b461a67a.js";import"./Tooltip-5624ecb6.js";import"./Switch-bdda7b10.js";import"./index-569e3c49.js";import"./Suffix-9f9d022f.js";import"./create-bbda4d67.js";import"./Empty-dd1b91e9.js";import"./Checkbox-2d4945a3.js";import"./RadioGroup-92bc79b0.js";import"./Dropdown-8ccd025e.js";function O(){const e=y({params:{pluginName:null,datasourceName:null},list:[],loading:!1,page:1,pageSize:10,itemCount:0}),a=h(),u=v(),s=async()=>{const t=await w({pageNo:e.page,pageSize:e.pageSize,pluginName:e.params.pluginName||"",datasourceName:e.params.datasourceName||""});e.list=t==null?void 0:t.data,e.itemCount=t==null?void 0:t.total},o=()=>{e.list.length===1&&e.page>1&&--e.page,s()},l=async t=>{await I(t),o()},p=()=>{const{pluginName:t,datasourceName:n}=a.query;t&&(e.params.pluginName=t,n&&(e.params.datasourceName=n))},m=()=>{const t=e.params.pluginName?{pluginName:e.params.pluginName}:null;e.params.datasourceName&&(t.datasourceName=e.params.datasourceName),t&&u.replace({query:{tab:a.query.tab,...t}}),e.page=1,s()},d=t=>{e.page=t,s()},r=t=>{e.page=1,e.pageSize=t,s()};return _(()=>{p(),m()}),{state:e,onSearch:m,onDelete:l,onPageChange:d,onPageSizeChange:r}}function E(e){const{t:a}=g.useI18n(),u=S(),s=()=>[{title:"ID",key:"id",render:(l,p)=>p+1},{title:a("virtual_tables.table_name"),key:"tableName",align:"left"},{title:a("virtual_tables.database_name"),key:"databaseName",align:"left"},{title:a("virtual_tables.source_name"),key:"datasourceName",align:"left"},{title:a("virtual_tables.source_type"),key:"pluginName"},{title:a("virtual_tables.creator"),key:"createUserName"},{title:a("virtual_tables.creation_time"),key:"createTime"},{title:a("virtual_tables.updater"),key:"updateUserName"},{title:a("virtual_tables.update_time"),key:"updateTime"},j({title:a("virtual_tables.operation"),key:"operation",buttons:[{text:a("datasource.edit"),icon:C(q),onClick:l=>void e(l.tableId,"edit")},{isDelete:!0,text:a("datasource.delete"),onPositiveClick:l=>void e(l.tableId,"delete"),negativeText:a("datasource.cancel"),positiveText:a("datasource.confirm"),popTips:a("datasource.delete_confirm")}]})];return k(g.useI18n().locale,()=>{u.value=s()}),_(()=>{u.value=s()}),{columns:u}}function b(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!T(e)}const _e=z({setup(){const{t:e}=g.useI18n(),a=v(),{state:u}=x(!0),{columns:s}=E((r,t)=>{t==="edit"?a.push({name:"virtual-tables-editor",params:{id:r}}):p(r)}),{state:o,onSearch:l,onDelete:p,onPageChange:m,onPageSizeChange:d}=O();return()=>i(c,{vertical:!0},{default:()=>[i(N,{title:e("virtual_tables.virtual_tables")},{"header-extra":()=>{let r,t;return i(c,null,{default:()=>[i(U,{value:o.params.pluginName,"onUpdate:value":n=>o.params.pluginName=n,clearable:!0,placeholder:e("virtual_tables.source_type_tips"),options:u.types,class:P["type-width"]},null),i(D,{value:o.params.datasourceName,"onUpdate:value":n=>o.params.datasourceName=n,clearable:!0,placeholder:e("virtual_tables.source_name_tips")},null),i(f,{type:"primary",onClick:l},b(r=e("virtual_tables.search"))?r:{default:()=>[r]}),i(f,{onClick:()=>{a.push({name:"virtual-tables-create"})},type:"success"},b(t=e("virtual_tables.create"))?t:{default:()=>[t]})]})}}),i(N,null,{default:()=>[i(c,{vertical:!0},{default:()=>[i(V,{columns:s.value,data:o.list,loading:o.loading,striped:!0},null),i(c,{justify:"center"},{default:()=>[i(L,{page:o.page,"onUpdate:page":r=>o.page=r,"page-size":o.pageSize,"onUpdate:page-size":r=>o.pageSize=r,"item-count":o.itemCount,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,"on-update:page":m,"on-update:page-size":d},null)]})]})]})]})}});export{_e as default};
