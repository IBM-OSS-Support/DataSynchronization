import{e as y,n as v,i as f,b_ as b,v as h,p as a,s as g}from"./index-5e2885e4.js";import{a as N,g as _,b as w,N as C}from"./Grid-7fd51304.js";import{N as F,f as O,a as j}from"./FormItem-7f69a4d7.js";import{N as x}from"./Input-1bbd5e95.js";import{N as S}from"./Select-94feec49.js";import{a as V,N as D}from"./Checkbox-2d4945a3.js";import{N as G}from"./Space-d49acb7b.js";import{s as E}from"./service-d19f0ccd.js";const P=Object.assign(Object.assign({},_),O),$=y({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:P,setup(){const s=v(null);return{formItemInstRef:s,validate:(...t)=>{const{value:l}=s;if(l)return l.validate(...t)},restoreValidation:()=>{const{value:t}=s;if(t)return t.restoreValidation()}}},render(){return f(N,b(this.$.vnode.props||{},w),{default:()=>{const s=b(this.$props,j);return f(F,Object.assign({ref:"formItemInstRef"},s),this.$slots)}})}});function I(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!g(s)}const k={formStructure:{type:Object},model:{type:Object},name:{type:String,default:""},locales:{type:Object}},B=y({name:"DynamicFormItem",props:k,setup(s){const{t:e}=h.useI18n();return s.locales&&(h.useI18n().mergeLocaleMessage("zh_CN",{i18n:s.locales.zh_CN}),h.useI18n().mergeLocaleMessage("en_US",{i18n:s.locales.en_US})),{t:e,formatClass:(l,r)=>l.indexOf("[")>=0?l.split("[")[0].toLowerCase()+l.split("[")[1].split("]")[0]:l.toLowerCase()+"-"+r.toLowerCase(),formItemDisabled:(l,r)=>r.map(n=>l===n).indexOf(!1)<0}},render(){let s;return a(C,{xGap:10},I(s=this.formStructure.map(e=>{let o;return(e.show?this.formItemDisabled(this.model[e.show.field],e.show.value):!0)&&a($,{label:this.t(e.label),path:e.field,span:e.span||24},{default:()=>[e.type==="input"&&a(x,{class:`dynamic-form_${this.formatClass(this.name,e.field)}`,placeholder:e.placeholder?this.t(e.placeholder):"",value:this.model[e.field],"onUpdate:value":t=>this.model[e.field]=t,clearable:e.clearable,type:e.inputType,rows:e.row?e.row:4},null),e.type==="select"&&(e.show?this.formItemDisabled(this.model[e.show.field],e.show.value):!0)&&a(S,{class:`dynamic-form_${this.formatClass(this.name,e.field)}`,placeholder:e.placeholder?this.t(e.placeholder):"",value:this.model[e.field],"onUpdate:value":t=>this.model[e.field]=t,options:e.options.map(t=>({label:this.t(t.label),value:t.value}))},null),e.type==="checkbox"&&(e.show?this.formItemDisabled(this.model[e.show.field],e.show.value):!0)&&a(V,{class:`dynamic-form_${this.formatClass(this.name,e.field)}`,value:this.model[e.field],"onUpdate:value":t=>this.model[e.field]=t},{default:()=>[a(G,{vertical:e.vertical},I(o=e.options.map(t=>a(D,{label:this.t(t.label),value:t.value},null)))?o:{default:()=>[o]})]})]})}))?s:{default:()=>[s]})}});function H(s){const e={},o=(t,l)=>t||(l==="select"?null:"");return s.forEach(t=>{t.field&&(e[t.field]=o(t.defaultValue,t.type))}),e}const L=(s,e)=>E({url:s,method:e});function J(s,e){return e.map(o=>{o.api&&L(s[o.api].url,s[o.api].method).then(t=>{o.options=t.map(l=>({label:l.label,value:l.value}))})}),e}function Q(s,e,o){const t={},l=(r,n)=>{const m={required:r.required,trigger:r.trigger};if(r.type==="non-empty")m.validator=(u,i)=>{if(!e[n])return Error(o(r.message))};else if(r.type==="union-non-empty"){const u=r.fields.splice(r.fields.findIndex(i=>i!==n),1);m.validator=(i,d)=>{const c=u.map(p=>!!e[p]);if(!d&&c.includes(!0))return Error(o(r.message))}}else if(r.type==="mutually-exclusive"){const u=r.fields.splice(r.fields.findIndex(i=>i!==n),1);m.validator=(i,d)=>{const c=u.map(p=>!!e[p]);if(d&&c.indexOf(!1)<0)return Error(o(r.message))}}return m};return s.forEach(r=>{!r.validate||Object.keys(r.validate).length<=0||(t[r.field]=l(r.validate,r.field))}),t}function W(s){return s.map(e=>(delete e.validate,delete e.api,e))}export{B as D,$ as N,Q as a,W as b,J as c,H as u};
